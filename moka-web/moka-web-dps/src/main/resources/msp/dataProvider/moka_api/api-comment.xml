<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2017 Joongang Ilbo, Inc. All rights reserved.
  -->

<apiConfig>

  <!-- 댓글 차단ID 목록  period="*/5 * * * * *"-->
  <api id="comment.blockid" expire="2m">
    <description>댓글 차단ID 목록을 조회한다.</description>
    <parameter>
      <div desc="태그타입" require="Y" default="U">^[I|U|W]$</div>
    </parameter>
    <request dmlType="sp" setNames="_DATA" outParam="_TOTAL">dps.comment.banned</request>
  </api>

  <!-- 댓글 차단IP 목록 -->
  <api id="comment.blockip" expire="2m">
    <description>댓글 차단IP 목록을 조회한다.</description>
    <parameter>
      <div desc="태그타입" require="Y" default="I">^[I|U|W]$</div>
    </parameter>
    <request dmlType="sp" setNames="_DATA" outParam="_TOTAL">dps.comment.banned</request>
  </api>

  <!-- 댓글 금지어 목록 -->
  <api id="comment.blockword" expire="2m">
    <description>댓글 금지어 목록을 조회한다.</description>
    <parameter>
      <div desc="태그타입" require="Y" default="W">^[I|U|W]$</div>
    </parameter>
    <request dmlType="sp" setNames="_DATA" outParam="_TOTAL">dps.comment.banned</request>
  </api>

  <!--
  댓글 목록 조회
  기사의 댓글목록조회: http://localhost:8081/moka_api/comment?contentId=23530553&referrer=joongang.joins.com/article&order=3
  레퍼러기준 댓글목록조회: http://localhost:8081/moka_api/comment?referrer=joongang.joins.com/eo_i/4
  기사의 내댓글목록조회: http://localhost:8081/moka_api/comment?contentId=23530553&referrer=joongang.joins.com/article&my=Y
  -->
  <api id="comment" membership="cookie">
    <description>기사 또는 기자 또는 레퍼러의 댓글 목록조회을 조회한다.</description>
    <parameter>
      <contentId desc="기사키 또는 기자키">^[0-9]{1,9}$</contentId>
      <referrer desc="레퍼러" require="Y">^.{1,500}$</referrer>
      <order desc="정렬" type="number">^[0-9]{1}$</order>
      <my desc="내댓글 여부" defualt="N">^[Y|N]{1}$</my>
    </parameter>
    <request eval="Y" dmlType="sp" setNames="_DATA" outParam="_TOTAL,_DISP_TOTAL"><![CDATA[
          //1. 내 댓글 조회가 아닐경우 파라미터 변경
          if ($param.get("my") == null || $param.get("my").equals("N")) {
            $param.put("member_memSeq", null);
            $param.put("member_loginType", null);
          }

          //2. SP변경
          var queryId = "";
    			if ($param.get("contentId") != null) {
    			  queryId = "dps.comment.list";           // 기사댓글목록조회
    			} else if ($param.get("referrer") != null) {
    			  queryId = "dps.comment.referrerList";   // 기자댓글목록조회
    			}
    			queryId;
    		]]></request>
    <keys>
      contentId
      referrer
      order
      my
      #paging
    </keys>
  </api>

  <!--  <api id="comment.insert" membership="cookie" method="post">-->
  <!--    <description>댓글을 등록한다</description>-->
  <!--    <parameter>-->
  <!--      <parent desc="부모댓글SEQ" default="0" type="number">^[0-9]$</parent>-->
  <!--      <contentId desc="기사ID 또는 기자SEQ">^[0-9]$</contentId>-->
  <!--      <remoteIp/>-->
  <!--    </parameter>-->
  <!--    <request dmlType="sp" setNames="_DATA">dps.comment.commentInsert</request>-->
  <!--    <keys>-->
  <!--      parent-->
  <!--      contentId-->
  <!--      content-->
  <!--      referer-->
  <!--    </keys>-->
  <!--  </api>-->

</apiConfig>

